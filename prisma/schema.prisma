datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  ADMIN
  STAFF
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  WON
  LOST
}

enum QuoteStatus {
  NEW
  SENT
  ACCEPTED
  DECLINED
}

enum QuoteService {
  DEV
  DESIGN
  SECURITY
  AUTOMATION
}

model User {
  id           String     @id @default(cuid())
  name         String
  email        String     @unique
  passwordHash String
  role         Role
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  leadNotes    LeadNote[] @relation("UserLeadNotes")
}

model Lead {
  id        String     @id @default(cuid())
  name      String
  email     String
  company   String
  phone     String?
  source    String
  status    LeadStatus @default(NEW)
  message   String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  notes     LeadNote[]

  @@index([status])
}

model LeadNote {
  id               String   @id @default(cuid())
  leadId           String
  body             String
  createdByUserId  String
  createdAt        DateTime @default(now())

  lead      Lead @relation(fields: [leadId], references: [id], onDelete: Cascade)
  createdBy User @relation("UserLeadNotes", fields: [createdByUserId], references: [id], onDelete: Restrict)

  @@index([leadId])
}

model Quote {
  id          String       @id @default(cuid())
  name        String
  email       String
  company     String
  budgetRange String
  timeline    String
  service     QuoteService
  details     String
  status      QuoteStatus  @default(NEW)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([status])
}

model Session {
  id        String   @id @default(cuid())
  sid       String   @unique
  data      String
  expiresAt DateTime
}
